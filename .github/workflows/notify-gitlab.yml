name: Database Migration and Notify
on:
  push:
    branches: [ main ]

jobs:
  migrate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Run SQL Migrations
        run: |
          echo "Executing SQL/Alchemy migrations..."
          # Your actual migration commands go here

      - name: The Bridge - Trigger GitLab Pipeline
        if: success() # Only triggers if migrations pass
        run: |
          curl --request POST \
            --form token=${{ secrets.GITLAB_TRIGGER_TOKEN }} \
            --form ref=main \
            "https://gitlab.com/api/v4/projects/${{ secrets.GITLAB_PROJECT_ID }}/trigger/pipeline"
